@model Gestion_Activos.Models.Ticket
@{
    ViewBag.Title = "Instalaciones";
    Layout = "~/Views/MasterPage/MasterPage.cshtml";
}
@Styles.Render("~/bundle/scripts/checkboxcss")
@Scripts.Render("~/bundles/sketch")

<div class="row">
    <div class="col-xs-12 col-lg-12">
        <div class="box box-primary">
            <div class="box-header with-border">
                <i class="fa fa-ticket"></i>
                <h3 class="box-title">Boleta #@Html.DisplayFor(model => model.id)</h3>
            </div>
            <div class="box-body no-padding" style="min-height:200px;">
                <div class="col-xs-12 col-lg-9">
                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#tab_0" data-toggle="tab" aria-expanded="true">1.Información de la boleta</a></li>
                            <li><a href="#tab_1" data-toggle="tab" aria-expanded="false">2.Productos y series</a></li>
                            <li><a href="#tab_2" data-toggle="tab" aria-expanded="false">3.Bitácora de registro</a></li>
                        </ul>
                        <div class="tab-content">
                            @* primera pestaña *@
                            <div class="tab-pane active" id="tab_0">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="box box-widget widget-user-2">
                                            <div class="widget-user-header bg-green-gradient">
                                                <h3>Boleta: #@Html.DisplayFor(model => model.id)</h3>
                                                <h4>Evento: @Html.DisplayFor(model => model.type)</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-xs-12 border-right">
                                        <div class="box box-widget widget-user-2  no-border">
                                            <div class="box-footer no-padding">
                                                <ul class="nav nav-stacked">
                                                    <li><h4><span class="text-light-blue text-bold">Detalle:</span></h4></li>
                                                    <li><h4>Problema: @Html.DisplayFor(model => model.problem)</h4>
                                                    <h4>Fecha Visita: @Html.DisplayFor(model => model.visit_date) @Html.DisplayFor(model => model.hour_programmed)</h4>
                                                    <h4>Estatus: @Html.DisplayFor(model => model.status)</h4>
                                                    <h4>Dirección: @Html.DisplayFor(model => model.address)</h4></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-xs-12">
                                        <div class="box box-widget widget-user-2 no-border">
                                            <div class="box-footer no-padding">
                                                <ul class="nav nav-stacked">
                                                    <li><h4><span class="text-light-blue text-bold">Mas información:</span></h4></li>
                                                    <li>
                                                        <h4>Tiquete Credomatic: @Html.DisplayFor(model => model.ticket_cred)</h4>
                                                        <h4>Creado por: @Html.DisplayFor(model => model.user)</h4>
                                                        <h4>Fecha creación: @Html.DisplayFor(model => model.date)</h4>
                                                        <h4>Técnico asignado: @Html.DisplayFor(model => model.technical)</h4>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                               @* avances *@
                                <hr>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <h4><span class="text-red text-bold">Avances:</span></h4>
                                        <div class="table-responsive no-padding">
                                            <table class="table table-hover" id="tableAvance">
                                                <thead>
                                                    <tr>
                                                        <th>Id</th>
                                                        <th>Responsable</th>
                                                        <th>Fecha</th>
                                                        <th>Detalle</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @if (Model.advances != null)
                                                    {
                                                        foreach (var advance in Model.advances)
                                                        {
                                                        <tr>
                                                            <td>@Html.DisplayFor(model => advance.id)</td>
                                                            <td>@Html.DisplayFor(model => advance.user)</td>
                                                            <td>@Html.DisplayFor(model => advance.date)</td>
                                                            <td>@Html.DisplayFor(model => advance.detail)</td>
                                                        </tr>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        <tr>
                                                            <td colspan="4">No se han agregado avances</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane " id="tab_1">
                                @if (Model.movemetns != null)
                                {
                                    foreach (var move in Model.movemetns)
                                    {
                                        if (move.products_list != null)
                                        {
                                            <div>
                                                <h4 class="text-black">Movimiento inventario: @move.num_move</h4>
                                                <div class="table-responsive no-padding">
                                                    <table class="table table-hover" id="table1">
                                                        <thead>
                                                            <tr>
                                                                <th style="width:35%">Descripción</th>
                                                                <th style="width:15%">Serie</th>
                                                                <th style="width:10%">Validar Serie</th>
                                                                <th style="width:20%">Estado</th>
                                                                <th style="width:20%">Evento</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (var product in move.products_list)
                                                            {
                                                                <tr>
                                                                    <td class="td_descripcion">@Html.DisplayFor(model => product.description)</td>
                                                                    @if (product.serial_number.Trim() == "PENDIENTE")
                                                                    {
                                                                        <td class="td_serie" id="@product.serial_number.Trim()" serial2C="@product.serial_number.Trim()" consecutive="@product.id" category="@product.category">@Html.DisplayFor(model => product.serial_number) @Html.DisplayFor(model => product.id)</td>
                                                                    }
                                                                    else
                                                                    {
                                                                        <td class="td_serie" id="@product.serial_number.Trim()" serial2C="@product.serial_number.Trim()" consecutive="@product.id" category="@product.category">@Html.DisplayFor(model => product.serial_number)</td>
                                                                    }

                                                                    @if (product.serial_number.Trim() != "---SIN SERIE---")
                                                                    {
                                                                        <td>
                                                                            <input type="text" correct_serial="@product.serial_number" name="serie2" required="required">
                                                                        </td>
                                                                    }   
                                                                    else
                                                                    {
                                                                        <td></td>
                                                                    }
                                                                    <td>
                                                                        <select class="form-control" name="estado_producto" id="@product.id" cod_prod="@product.cod_prod">
                                                                            @if (TempData["damages"] != null)
                                                                            {
                                                                                List<String> damages = (List<String>)TempData["damages"];
                                                                                foreach (var damage in damages)
                                                                                {
                                                                                    <option value="@damage">@damage</option>
                                                                                }
                                                                            }
                                                                        </select>
                                                                    </td>
                                                                    @if (product.serial_number.Trim() != "---SIN SERIE---")
                                                                    {
                                                                        <td>
                                                                            <button type="button" class="btn btn-block btn-info btn-sm btn_serie" data-toggle="modal" data-target="#modal_serie">
                                                                                Gestionar
                                                                            </button>
                                                                        </td>
                                                                    }
                                                                    else
                                                                    {
                                                                        <td></td>
                                                                    }
                                                                </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <br>
                                        }
                                        else
                                        {<h3>No hay productos</h3>}
                                    }
                                }else {<h3>No hay movimientos asociados</h3>}
                            </div>
                            <div class="tab-pane" id="tab_2">
                                <div class="row">
                                    <div class="col-xs-12">
                                       @using (Html.BeginForm("Close_Ticket_I", "Ticket", FormMethod.Post, new { id = "formI", enctype = "multipart/form-data" }))
                                       {
                                            <input type="hidden" id="id_ticket" name="id_ticket"    value="@Model.id">
                                            <input type="hidden" id="tip_mov" name="tipo_mov"       value="@Model.type">
                                            <input type="hidden" id="membership_number" name="membership_number" value="@Model.client.membership_number">
                                            <input type="hidden" id="local_name" name="local_name"  value="@Model.client.local_name">
                                            <input type="hidden" id="num_doc_serie"      readonly>
                                            <input type="hidden" id="email" name="email" readonly>
                                            
                                             <div class="col-lg-2 col-xs-4">
                                                <h4>Tipo conexión</h4>
                                                <div class="form-group no-margin">
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_conecion" class="flat-red" value="1">
                                                            Internet
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_conecion" class="flat-red" value="2">
                                                            Inalámbrica
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_conecion" class="flat-red" value="3">
                                                            Modem
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_conecion" class="flat-red" value="4">
                                                            Cable
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_conecion" class="flat-red" value="5">
                                                            Datacard
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                                
                                            <div class="col-lg-2 col-xs-4 border-left">
                                                <h4>Detalle instalación</h4>
                                                <div class="form-group no-margin">
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_detalle_install" class="flat-red" value="1">
                                                            Lugar instalación
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_detalle_install" class="flat-red" value="2">
                                                            Espacio caja dinero
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_detalle_install" class="flat-red" value="3">
                                                            Espacio impresora
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_detalle_install" class="flat-red" value="4">
                                                            Espacio CPU
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_detalle_install" class="flat-red " value="5">
                                                            Espacio Monitor
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-2 col-xs-4 border-left">
                                                <h4>Exposición equipo</h4>
                                                <div class="form-group no-margin">
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_exposicion_equip" class="flat-red" value="0">
                                                            Humedad
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_exposicion_equip" class="flat-red" value="1">
                                                            Grasa
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_exposicion_equip" class="flat-red " value="2">
                                                            Sobre Voltaje
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_exposicion_equip" class="flat-red " value="3">
                                                            Plagas
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_exposicion_equip" class="flat-red " value="4">
                                                            Polvo
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_exposicion_equip" class="flat-red " value="5">
                                                            Oxidación
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_exposicion_equip" class="flat-red " value="6">
                                                            Desgaste
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-6 col-xs-12 border-left">
                                                <h4>*Pruebas realizadas</h4>
                                                <div class="form-group no-margin">
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_otros" class="flat-red" value="1">
                                                            Se realizan pruebas de lectura/escritura
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_otros" class="flat-red" value="2">
                                                            Pruebas de encendido y apagado
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_otros" class="flat-red " value="3">
                                                            Pruebas de impresión
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_otros" class="flat-red " value="4">
                                                            Se indica como agregar el rollo de papel
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_otros" class="flat-red " value="5">
                                                            Se ingresa al acceso directo del punto de venta
                                                        </label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type = "checkbox" name="chk_otros" class="flat-red " value="6">
                                                            Se hacen recomendaciones
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <hr>
                                                    <div class="form-group">
                                                        <h4>Observaciones:</h4>
                                                        <div class="form-group">
                                                            <textarea class="form-control" id="observaciones" name="observaciones" style="resize:none" rows="3" maxlength="999"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                           if (FrontUser.Have_Permission(Permissions_Enum.Cerrar_ticket)) {
                                            <div class="col-lg-3 pull-right col-xs-12">
                                                <button type = "button" class="btn btn-block btn-success btn-lg" id="btn_cerrar_i" onclick="">
                                                    Cerrar boleta
                                                </button>
                                            </div>
                                           }
                                       } 
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-xs-12 border-left">
                    <div class="box-primary no-padding">
                        <div class="with-border">
                            <h4 class="box-header box-title with-border">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" class="collapsed">
                                   + Información del afiliado:
                                </a>
                            </h4>
                        </div>
                        <div id="collapseOne" class="panel-collapse in" aria-expanded="true" style="height: auto;">
                            <div class="box-body">
                                @if (Model.client != null)
                                {
                                    <dl>
                                        <dt>
                                            @Html.DisplayNameFor(model => model.client.membership_number)
                                        </dt>

                                        <dd>
                                            @Html.DisplayFor(model => model.client.membership_number)
                                        </dd>

                                        <dt>
                                            @Html.DisplayNameFor(model => model.client.contact)
                                        </dt>

                                        <dd>
                                            @Html.DisplayFor(model => model.client.contact)
                                        </dd>

                                        <dt>
                                            @Html.DisplayNameFor(model => model.client.local_name)
                                        </dt>

                                        <dd>
                                            @Html.DisplayFor(model => model.client.local_name)
                                        </dd>

                                        <dt>
                                            @Html.DisplayNameFor(model => model.client.phone)
                                        </dt>

                                        <dd>
                                            @Html.DisplayFor(model => model.client.phone)
                                        </dd>

                                        <dt>
                                            @Html.DisplayNameFor(model => model.client.address)
                                        </dt>
                                            
                                        <dd>
                                            @Html.DisplayFor(model => model.client.address)
                                        </dd>

                                        <dt>
                                            @Html.DisplayNameFor(model => model.client.province)
                                        </dt>

                                        <dd>
                                            @Html.DisplayFor(model => model.client.province)
                                        </dd>

                                        <dt>
                                            @Html.DisplayNameFor(model => model.client.canton)
                                        </dt>

                                        <dd>
                                            @Html.DisplayFor(model => model.client.canton)
                                        </dd>

                                        <dt>
                                            @Html.DisplayNameFor(model => model.client.district)
                                        </dt>

                                        <dd>
                                            @Html.DisplayFor(model => model.client.district)
                                        </dd>
                                    </dl>
                                }
                                else
                                {
                                    <div class="callout callout-warning">
                                        <h4>No hay información del afiliado</h4>
                                        <p>Favor comunicarlo a soporte</p>
                                    </div>
                                }
                            </div>
                        </div>

                        <div class="col-xs-12 pull-right">
                            <button type="button" class="btn btn-block btn-warning btn-sm" data-toggle="modal" data-target="#modal_avance">
                                Agregar avance
                            </button>
                        </div>
                        
                    </div>
                </div>
            </div>
            <div class="box-footer">
                <div class="pull-left col-xs-6 col-lg-2 ">
                    <button type="button" class="btn btn-block btn-info btn-sm" onclick="location.href='@Url.Action("Index")'">
                        Regresar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@*modals*@
<div class="modal fade" id="modal_error" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">
                    <i class="fa fa-exclamation-circle"></i>
                    Alerta!
                </h4>
            </div>
            <div class="modal-body">
                <center>
                    <div class="form-group">
                        <h3 id="mjsError" class="text-yellow"></h3>
                    </div>
                </center>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success pull-right" data-dismiss="modal">Entendido</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_serie" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">
                    <i class="fa  fa-exchange"></i>
                    Gestión de series
                </h4>
            </div>

            <div class="modal-body">
                <div class="form-group">
                    <dl>
                        <dt>Descripción:</dt>
                        <dd id="dd_descip"></dd>
                    </dl>
                </div>
                <div class="form-group inline margin-bottom row">
                    <div class="col-xs-6">
                        <label>Serie actual:</label>
                        <input type="text" class="form-control" id="txt_serie_actual" readonly>
                    </div>
                    <div class="col-xs-6">
                        <label>Serie nueva:</label>
                        <input type="text" class="form-control" id="txt_serie_nueva">
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-xs-6">
                        <button type="button" class="btn btn-block btn-warning" id="btn_limpiar_cambios">Limpiar cambios</button>
                    </div>
                    <div class="col-xs-6">
                        <button type="button" class="btn btn-block btn-success" id="btn_cambiar_serie">Cambiar series!</button>
                    </div>
                </div>

                <div id="error_msj" class="form-group row" hidden>
                    <div class="col-xs-12">
                        <div class="callout callout-danger">
                            <p id="error_mjs_p"></p>
                        </div>
                    </div>
                </div>

                <div id="succes_mjs" class="form-group row" hidden>
                    <div class="col-xs-12">
                        <div class="callout callout-info">
                            <p>Serie disponible, se guardará el cambio una vez se cierre el tiquete</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info pull-right" data-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_confirmacion" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">
                    <i class="fa fa-send"></i>
                    Procesar tiquete.
                </h4>
            </div>

            <div class="modal-body" id="body1">
                <div class="callout callout-danger" id="error_pc_track" hidden >
                    <h4>Alerta! <i class="fa fa-fw active fa-meh-o"></i></h4>
                    <p id="msj_pc_track">
                    </p>
                </div>

                <div class="mailbox-read-info">
                    <h2>Confirmación del tiquete #: <span class="text-green text-bold">@Model.id</span></h2>
                </div>

                <div class="form-group">
                    <label>Email del afiliado:</label>
                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-envelope"></i></span>
                        <input type="email" class="form-control" placeholder="example@email.com" id="email_enviar" name="email">
                    </div>
                </div>
                
                <div class="row">
                    <center><h3>¿Está seguro que desea procesar el tiquete?</h3></center>
                    <div class="col-xs-9 col-xs-offset-2 row">
                        <div class="col-xs-5">
                            <button type="button" class="btn btn-block btn-danger btn-lg" data-dismiss="modal"><i class="fa fa-close"></i>Cancelar</button>
                        </div>
                        <div class="col-xs-5">
                            <a  class="btn btn-block btn-success btn-lg" id="btn-confirmacion"><i class="fa  fa-check"></i>Aceptar </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-body" id="body2" hidden>
                <div class="row">
                    <center><h3 id="mjs_send">Enviando E-mail un momento por favor...</h3></center>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>


<div class="modal fade" id="modal_avance" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">
                    <i class="fa fa-send"></i>
                    Actualizar ticket
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <center><h3>¿Está seguro que desea agregar un avance al ticket?</h3></center>
                    <div class="col-xs-12">
                        <div class="form-group">
                            <h4>Comentario de avance:</h4>
                            <div class="form-group">
                                <textarea class="form-control" name="c_cierre" style="resize:none" id="comentario" rows="3" maxlength="200" placeholder="Este comentario se guardará en bitacora"></textarea>
                            </div>
                        </div>
                        <hr>
                    </div>
                    
                    <div class="col-xs-9 col-xs-offset-2 row">
                        <div class="col-xs-5">
                            <button type="button" class="btn btn-block btn-danger btn-lg" data-dismiss="modal"><i class="fa fa-close"></i>Cancelar</button>
                        </div>
                        <div class="col-xs-5">
                            <button type="button" class="btn btn-block btn-success btn-lg" id="btn_confirmacion_update"><i class="fa  fa-check"></i>Aceptar </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <p>Este avance no cierra el tiquete, solo agrega información a la bitácora</p>
            </div>
        </div>
    </div>
</div>
@*end modals*@

<style>
    input[type=checkbox] {
        transform: scale(1.7);
    }
</style>

@Scripts.Render("~/bundle/scripts/dataTables")
<script src="@Url.Content("~/Scripts/Views/Ticket/Details.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/Views/Ticket/TicketAdvance.js")" type="text/javascript"></script>